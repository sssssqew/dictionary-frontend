<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사전 검색 서비스</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 검색창 -->
    <div id="search-box">
        <input id="search" type="text" value="" placeholder="단어를 검색하세요 ...">
        <input id="submit" type="submit" value="submit">
    </div>

    <!-- 사전 -->
    <div id="container">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAdVBMVEX19vcdHhwAAAD////5+vuWlpYDBgK8vL0WFxYLDQx/f39ISUgUFRMGCQOOjo5UVFOFhYXu7/Db29xeXl4zMzLJycqhoqGysrJlZWTBwsKnp6ji4+MbHBptbW3Q0dHw8fInJyYwMC8/Pz51dXRCQkGsrazW1tfj+rIuAAAC00lEQVR4nO3a23KiQBRAUTinFVBULmIUEW/R///EaYg6ZiqVyUsP4OxVFSGkH9hBSbfG8wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPAXxtw2pt37tL3tePe9p58PR1oUabMNyvJSqGe2b2X5lhpzreuizuyBusjM1g4y+6K4jcuGlGgykcJ4epLGXLftVra6aLcno5WcdSWyUjvS00N7eDOgxI9Cs5VwOj+EBy0lmpwjKTWPj7v3UDa6HE9sYbxu4u3oeDGvorN2fd4/dytsHjWZhToSX1VkpPk4b5reboVVZJrCQiTTnayHWjiu2kIjY1s4W2j6u9CX7FZ41Vzylyws74Umq4d0q/lp4SFap/dC1QFdwh8X7qr48Sxd5fMXvIaTnWzuhZOXfB2eL5LMHoXDvpce7F+LL56lWzmFr1E4rkT8Lwo1DP1XKTwtq68Kd/FzYTv9fv7qraatVn2a09yfpXZO86nwIv5tTtMUbou6mY+btJmO3ybv/dTMNNfnSSpxXh7jw9OdJlomi/gxL93ZKZwtvNrR5WK2tuOWGohoLZLaX0Td36vYXEORsR7bNUNiz1xsoV1kfKwtDp767dpirRo3a4uqPZzbcaeBFHppsLHM/jIajQL7grT7ZrPJTNEctidumscsqI2pN4Fn9m923KqwRwqztWPTILBrxqDHz9LHot0Y/diYx7L+jzX+/Vt9OjKAOw0A50x/OAoMRn3h6O05O8Ea94M4WjRrEvlh1L3QrlacFYbTZNK15D10WGgn0d2bRC4L581q1X3Et6fhvjCdLhybfhfwLwoldkw6L/Qdo5BCCimkkEIKKaSQQgoppJBCCimkkML/pXDmWNeF+2TuWNJx4Wu/q9+HT2YSl4XVctq9Y+Ww0K/C7lXuPiGdSF84+pTb1EFfXF39M0Z/uAkEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgP/KL1dAf1U7KgYBAAAAAElFTkSuQmCC"/>
    </div>
    <script>
        const query = document.getElementById('search')
        const submitBtn = document.getElementById('submit')
        const BASE_URL = 'http://localhost:5000/api/words'

        function checkIfStringHasSpecialCharacter(str) {
            const re = /[`!@#$%^&*()_+\-=\[\]{};':"\\|.<>\/?~]/;
            return re.test(str);
        }
        // 검색어가 숫자가 들어간 경우 검색이 안되도록 함
        function checkIfStringHasNumbers(str) {
            return /\d/.test(str);
        }
        // 영어 문자가 들어간 경우 검색이 안되도록 함
        function checkIfStringHasLetters(str){
            return /[a-zA-Z]/.test(str)
        }
        // 버튼 활성화
        function enableSubmitBtn(state){
            submitBtn.disabled = state
        }
        // 서버 데이터 가져오기
        function getData(baseUrl, query){
            enableSubmitBtn(true) // 비활성화
            console.log('서버 접속중 ...')
            // 사용자 입력 유효성 검증
            if(checkIfStringHasSpecialCharacter(query)){
                enableSubmitBtn(false) // 활성화
                container.innerHTML = "Your search keyword has special character. Retype only hangle! !"
                return;
            }
            if(checkIfStringHasNumbers(query)){
                enableSubmitBtn(false) // 활성화
                container.innerHTML = "Your search keyword has Numbers. Retype only hangle! !"
                return;
            }
            // if(checkIfStringHasLetters(query)){
            //     enableSubmitBtn(false) // 활성화
            //     container.innerHTML = "우리는 한국인입니다. 한글을 사랑하므로 한글 단어를 입력하세요!"
            //     return;
            // }
            fetch(`${baseUrl}/${query}`, {
                headers: {
                    "Content-Type": "application/json",
                    // "Access-Control-Allow-Origin": "*" // 이 코드 때문에 CORS 에러가 발생한것임. 이 코드 주석처리하면 프론트엔드에서 곧바로 외부 API 접근가능하다. (프록시나 서버가 필요없음)
                }
           })
            .then( res => res.json() )
            .then( data => {
                enableSubmitBtn(false) // 활성화
                console.log(data)
                const {words} = data;
                // 데이터 유효성 검증
                if(words.length === 0){
                    container.innerHTML = "No Words Found !"
                    return;
                }

                const template = words.map(word => {
                    return (
                        `
                            <div class="item">
                                <div class="word"><a href=${word.r_link} target="_blank">${word.r_word}<sup>${word.r_seq}</sup> (${word.r_chi})</a> - ${word.r_pos}</div>
                                <p class="description">${word.r_des}</p>
                            </div>
                        `
                    )
                })
                container.innerHTML = template.join("") // DOM 에 Template 삽입
            })
        }

        submitBtn.addEventListener('click', function(){
            console.log(query.value)
            getData(BASE_URL, query.value) // 5초 
        })
        query.addEventListener('keypress', function(e){
            console.log('key pressed')
            if(e.keyCode === 13){
                getData(BASE_URL, query.value)
            }

        })
        window.addEventListener('DOMContentLoaded', function(){
            getData(BASE_URL)
        })
    </script>
</body>
</html>